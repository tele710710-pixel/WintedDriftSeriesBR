<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üèÜ –§–°–ë Black Russia</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        *{margin:0;padding:0;box-sizing:border-box;}
        body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:linear-gradient(135deg,#1e3c72 0%,#2a5298 100%);color:#fff;min-height:100vh;padding:20px;}
        .container{max-width:500px;margin:0 auto;}
        .header{text-align:center;margin-bottom:30px;padding:25px;background:rgba(255,255,255,0.1);border-radius:20px;backdrop-filter:blur(10px);}
        .tabs{display:flex;justify-content:center;gap:10px;margin-bottom:25px;flex-wrap:wrap;}
        .tab{padding:12px 24px;border-radius:25px;background:rgba(255,255,255,0.2);cursor:pointer;transition:all 0.3s;font-weight:500;}
        .tab.active{background:linear-gradient(45deg,#00d4ff,#0099cc);box-shadow:0 8px 25px rgba(0,212,255,0.4);}
        .section{background:rgba(255,255,255,0.1);border-radius:20px;padding:25px;margin-bottom:20px;backdrop-filter:blur(15px);display:none;}
        .section.active{display:block;}
        .section h3{margin-bottom:20px;font-size:1.4em;}
        .table{width:100%;border-collapse:collapse;}
        .table th,.table td{padding:15px 10px;text-align:left;border-bottom:1px solid rgba(255,255,255,0.2);}
        .table th{font-weight:600;color:#00d4ff;text-transform:uppercase;font-size:0.85em;}
        .medal{font-size:1.3em;font-weight:bold;}
        .player-card{background:rgba(0,212,255,0.2);border-radius:15px;padding:20px;margin-bottom:15px;border:1px solid rgba(255,255,255,0.2);}
        .player-nick{font-size:1.3em;font-weight:bold;margin-bottom:10px;}
        .player-info{font-size:0.95em;opacity:0.9;line-height:1.5;}
        .refresh-btn{width:100%;background:linear-gradient(45deg,#00d4ff,#0099cc);color:#fff;border:none;padding:18px;border-radius:25px;font-size:18px;font-weight:600;cursor:pointer;margin-top:20px;transition:all 0.3s;}
        .refresh-btn:hover,.refresh-btn:active{transform:translateY(-3px);box-shadow:0 15px 35px rgba(0,212,255,0.5);}
        .empty{text-align:center;color:#aaa;font-style:italic;padding:50px 20px;}
        .rules-btn{background:linear-gradient(45deg,#ff6b6b,#ee5a52);color:#fff;border:none;padding:15px;border-radius:20px;font-size:16px;font-weight:600;cursor:pointer;width:100%;margin-top:15px;transition:all 0.3s;}
        .rules-btn:hover{transform:translateY(-2px);box-shadow:0 10px 25px rgba(255,107,107,0.4);}
        .rules-section{padding:20px;text-align:center;}
        .rules-link{color:#00d4ff;text-decoration:none;font-size:1.1em;font-weight:600;}
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>üèÜ –§–°–ë Black Russia</h1>
        <p>–†–µ–π—Ç–∏–Ω–≥–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã –¥—Ä–∏—Ñ—Ç-—Ç—É—Ä–Ω–∏—Ä–∞ ‚Ä¢ 2 —ç—Ç–∞–ø–∞</p>
    </div>
    
    <div class="tabs">
        <div class="tab active" data-tab="total">üèÜ –ò—Ç–æ–≥–æ–≤—ã–π –∑–∞—á—ë—Ç</div>
        <div class="tab" data-tab="stage1">üìà –≠—Ç–∞–ø 1</div>
        <div class="tab" data-tab="stage2">üìà –≠—Ç–∞–ø 2</div>
        <div class="tab" data-tab="players">üë• –£—á–∞—Å—Ç–Ω–∏–∫–∏</div>
        <div class="tab" data-tab="rules">üìú –†–µ–≥–ª–∞–º–µ–Ω—Ç</div>
    </div>

    <!-- –ò—Ç–æ–≥–æ–≤—ã–π –∑–∞—á—ë—Ç -->
    <div id="total" class="section active">
        <h3>üèÜ –ò–¢–û–ì–û–í–´–ô –ó–ê–ß–Å–¢</h3>
        <table class="table">
            <thead><tr><th>–ú–µ—Å—Ç–æ</th><th>–£—á–∞—Å—Ç–Ω–∏–∫</th><th>–û—á–∫–∏</th></tr></thead>
            <tbody id="total-table"></tbody>
        </table>
    </div>

    <!-- –≠—Ç–∞–ø 1 -->
    <div id="stage1" class="section">
        <h3>üìà –†–ï–ó–£–õ–¨–¢–ê–¢–´ –≠–¢–ê–ü–ê 1</h3>
        <table class="table">
            <thead><tr><th>–ú–µ—Å—Ç–æ</th><th>–£—á–∞—Å—Ç–Ω–∏–∫</th><th>–û—á–∫–∏</th></tr></thead>
            <tbody id="stage1-table"></tbody>
        </table>
    </div>

    <!-- –≠—Ç–∞–ø 2 -->
    <div id="stage2" class="section">
        <h3>üìà –†–ï–ó–£–õ–¨–¢–ê–¢–´ –≠–¢–ê–ü–ê 2</h3>
        <table class="table">
            <thead><tr><th>–ú–µ—Å—Ç–æ</th><th>–£—á–∞—Å—Ç–Ω–∏–∫</th><th>–û—á–∫–∏</th></tr></thead>
            <tbody id="stage2-table"></tbody>
        </table>
    </div>

    <!-- –£—á–∞—Å—Ç–Ω–∏–∫–∏ -->
    <div id="players" class="section">
        <h3>üë• –í—Å–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏</h3>
        <div id="players-list"></div>
    </div>

    <!-- ‚úÖ –ù–û–í–´–ô –†–ê–ó–î–ï–õ –†–ï–ì–õ–ê–ú–ï–ù–¢ -->
    <div id="rules" class="section">
        <div class="rules-section">
            <h3>üìú –†–µ–≥–ª–∞–º–µ–Ω—Ç —Ç—É—Ä–Ω–∏—Ä–∞</h3>
            <p>–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –¥—Ä–∏—Ñ—Ç-—Ç—É—Ä–Ω–∏—Ä–∞ –§–°–ë Black Russia</p>
            <button class="rules-btn" onclick="openRules()">
                üìñ –û—Ç–∫—Ä—ã—Ç—å —Ä–µ–≥–ª–∞–º–µ–Ω—Ç
            </button>
            <p style="margin-top:15px;font-size:0.9em;opacity:0.8;">
                Google –î–æ–∫—É–º–µ–Ω—Ç ‚Ä¢ –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
            </p>
        </div>
    </div>

    <button class="refresh-btn" onclick="loadData()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
    <div style="text-align:center;margin-top:10px;font-size:12px;color:#aaa;">–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫</div>
</div>

<script>
Telegram.WebApp.ready();Telegram.WebApp.expand();

let lastUpdate = 0;

// ‚úÖ –§–£–ù–ö–¶–ò–Ø –û–¢–ö–†–´–¢–ò–Ø –†–ï–ì–õ–ê–ú–ï–ù–¢–ê (–∑–∞–º–µ–Ω–∏ URL –Ω–∞ —Å–≤–æ–π Google Docs!)
function openRules() {
    // ‚Üê –ó–ê–ú–ï–ù–ò –ù–ê –°–í–û–Æ –°–°–´–õ–ö–£ GOOGLE DOCS!
    const rulesUrl = "https://docs.google.com/document/d/1qUAwBk2BMqlVW5SBMQr844zEBXwHzkAz/edit?usp=sharing&ouid=115043480596352731965&rtpof=true&sd=true";
    Telegram.WebApp.openLink(rulesUrl);
    Telegram.WebApp.HapticFeedback.impactOccurred('medium');
}

document.querySelectorAll('.tab').forEach(tab => {
    tab.addEventListener('click', () => {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        tab.classList.add('active');
        document.getElementById(tab.dataset.tab).classList.add('active');
        if(tab.dataset.tab !== 'rules') loadData(); // –ù–µ –∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ä–µ–≥–ª–∞–º–µ–Ω—Ç–∞
    });
});

async function loadData() {
    const now = Date.now();
    if(now - lastUpdate < 2000) return;
    lastUpdate = now;
    
    const btn = document.querySelector('.refresh-btn');
    btn.innerHTML = '‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞...';
    
    try {
        const response = await fetch('data.json?' + now);
        const data = await response.json();
        updateTable('total-table', data.total || {});
        updateTable('stage1-table', data.stages?.stage1 || {});
        updateTable('stage2-table', data.stages?.stage2 || {});
        updatePlayersList(data.players || {});
        btn.innerHTML = `‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–æ ${new Date().toLocaleTimeString('ru-RU')}`;
        setTimeout(() => btn.innerHTML = 'üîÑ –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ', 3000);
        Telegram.WebApp.HapticFeedback.impactOccurred('light');
    } catch(e) {
        console.error('–û—à–∏–±–∫–∞:', e);
        btn.innerHTML = '‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏';
        setTimeout(() => btn.innerHTML = 'üîÑ –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ', 2000);
    }
}

function updateTable(tableId, data) {
    const tbody = document.getElementById(tableId);
    tbody.innerHTML = Object.keys(data).length ?
        Object.entries(data).sort(([,a],[,b]) => b - a).slice(0,15).map(([nick, points], i) => {
            // ‚úÖ SVG –ú–ï–î–ê–õ–¨–ö–ò –≤–º–µ—Å—Ç–æ —ç–º–æ–¥–∑–∏!
            const medal = i === 0 ? 'ü•á' : 
                         i === 1 ? 'ü•à' : 
                         i === 2 ? 'ü•â' : 
                         `${i+1}.`;
            
            return `<tr>
                <td><span class="medal">${medal}</span></td>
                <td><strong>${nick.replace(/\\_/g, '_')}</strong></td>
                <td><strong>${points}</strong></td>
            </tr>`;
        }).join('') : 
        '<tr><td colspan="3" class="empty">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</td></tr>';

}

function updatePlayersList(players) {
    const container = document.getElementById('players-list');
    container.innerHTML = Object.keys(players).length ?
        Object.entries(players).sort(([,a],[,b]) => (b.total||0) - (a.total||0)).map(([nick, info]) =>
            `<div class="player-card">
                <div class="player-nick">${nick.replace('_', '_')}</div>
                <div class="player-info">
                    <div>üéñÔ∏è –†–∞–Ω–≥: <strong>${info.rank || '-'}</strong></div>
                    <div>üí≥ –°—á—ë—Ç: <strong>${info.account || '-'}</strong></div>
                    <div>üöó ${info.car || '-'} | üè∑Ô∏è <strong>${info.plate || '-'}</strong></div>
                    <div>üìä –≠—Ç–∞–ø 1: ${info.stage1 || 0} | –≠—Ç–∞–ø 2: ${info.stage2 || 0} | <strong>–ò—Ç–æ–≥: ${info.total || 0}</strong></div>
                </div>
            </div>`
        ).join('') : 
        '<div class="empty">–£—á–∞—Å—Ç–Ω–∏–∫–∏ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã</div>';
}

setInterval(loadData, 30000);
loadData();
</script>
</body>
</html>


